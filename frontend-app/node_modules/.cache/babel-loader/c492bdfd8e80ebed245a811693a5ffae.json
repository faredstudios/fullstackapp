{"ast":null,"code":"\"use strict\";\n\nvar __awaiter = this && this.__awaiter || function (thisArg, _arguments, P, generator) {\n  function adopt(value) {\n    return value instanceof P ? value : new P(function (resolve) {\n      resolve(value);\n    });\n  }\n\n  return new (P || (P = Promise))(function (resolve, reject) {\n    function fulfilled(value) {\n      try {\n        step(generator.next(value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n\n    function rejected(value) {\n      try {\n        step(generator[\"throw\"](value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n\n    function step(result) {\n      result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected);\n    }\n\n    step((generator = generator.apply(thisArg, _arguments || [])).next());\n  });\n};\n\nvar __importDefault = this && this.__importDefault || function (mod) {\n  return mod && mod.__esModule ? mod : {\n    \"default\": mod\n  };\n};\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.SafetyDepositConfig = exports.NonWinningConstraint = exports.WinningConstraint = exports.WinningConfigType = void 0;\n\nconst web3_js_1 = require(\"@solana/web3.js\");\n\nconst bn_js_1 = __importDefault(require(\"bn.js\"));\n\nconst bs58_1 = __importDefault(require(\"bs58\"));\n\nconst mpl_core_1 = require(\"@metaplex-foundation/mpl-core\");\n\nconst MetaplexProgram_1 = require(\"../MetaplexProgram\");\n\nconst buffer_1 = require(\"buffer\");\n\nvar WinningConfigType;\n\n(function (WinningConfigType) {\n  WinningConfigType[WinningConfigType[\"TokenOnlyTransfer\"] = 0] = \"TokenOnlyTransfer\";\n  WinningConfigType[WinningConfigType[\"FullRightsTransfer\"] = 1] = \"FullRightsTransfer\";\n  WinningConfigType[WinningConfigType[\"PrintingV1\"] = 2] = \"PrintingV1\";\n  WinningConfigType[WinningConfigType[\"PrintingV2\"] = 3] = \"PrintingV2\";\n  WinningConfigType[WinningConfigType[\"Participation\"] = 4] = \"Participation\";\n})(WinningConfigType = exports.WinningConfigType || (exports.WinningConfigType = {}));\n\nvar WinningConstraint;\n\n(function (WinningConstraint) {\n  WinningConstraint[WinningConstraint[\"NoParticipationPrize\"] = 0] = \"NoParticipationPrize\";\n  WinningConstraint[WinningConstraint[\"ParticipationPrizeGiven\"] = 1] = \"ParticipationPrizeGiven\";\n})(WinningConstraint = exports.WinningConstraint || (exports.WinningConstraint = {}));\n\nvar NonWinningConstraint;\n\n(function (NonWinningConstraint) {\n  NonWinningConstraint[NonWinningConstraint[\"NoParticipationPrize\"] = 0] = \"NoParticipationPrize\";\n  NonWinningConstraint[NonWinningConstraint[\"GivenForFixedPrice\"] = 1] = \"GivenForFixedPrice\";\n  NonWinningConstraint[NonWinningConstraint[\"GivenForBidPrice\"] = 2] = \"GivenForBidPrice\";\n})(NonWinningConstraint = exports.NonWinningConstraint || (exports.NonWinningConstraint = {}));\n\nclass SafetyDepositConfig extends mpl_core_1.Account {\n  constructor(pubkey, info) {\n    super(pubkey, info);\n\n    if (!this.assertOwner(MetaplexProgram_1.MetaplexProgram.PUBKEY)) {\n      throw (0, mpl_core_1.ERROR_INVALID_OWNER)();\n    }\n\n    if (!SafetyDepositConfig.isCompatible(this.info.data)) {\n      throw (0, mpl_core_1.ERROR_INVALID_ACCOUNT_DATA)();\n    }\n\n    this.data = deserialize(this.info.data);\n  }\n\n  static isCompatible(data) {\n    return data[0] === MetaplexProgram_1.MetaplexKey.SafetyDepositConfigV1;\n  }\n\n  static getPDA(auctionManager, safetyDeposit) {\n    return __awaiter(this, void 0, void 0, function* () {\n      return MetaplexProgram_1.MetaplexProgram.findProgramAddress([buffer_1.Buffer.from(MetaplexProgram_1.MetaplexProgram.PREFIX), MetaplexProgram_1.MetaplexProgram.PUBKEY.toBuffer(), new web3_js_1.PublicKey(auctionManager).toBuffer(), new web3_js_1.PublicKey(safetyDeposit).toBuffer()]);\n    });\n  }\n\n}\n\nexports.SafetyDepositConfig = SafetyDepositConfig;\n\nconst deserialize = buffer => {\n  const data = {\n    key: MetaplexProgram_1.MetaplexKey.SafetyDepositConfigV1,\n    auctionManager: bs58_1.default.encode(buffer.slice(1, 33)),\n    order: new bn_js_1.default(buffer.slice(33, 41), 'le'),\n    winningConfigType: buffer[41],\n    amountType: buffer[42],\n    lengthType: buffer[43],\n    amountRanges: [],\n    participationConfig: null,\n    participationState: null\n  };\n  const lengthOfArray = new bn_js_1.default(buffer.slice(44, 48), 'le');\n  let offset = 48;\n\n  for (let i = 0; i < lengthOfArray.toNumber(); i++) {\n    const amount = (0, mpl_core_1.getBNFromData)(buffer, offset, data.amountType);\n    offset += data.amountType;\n    const length = (0, mpl_core_1.getBNFromData)(buffer, offset, data.lengthType);\n    offset += data.lengthType;\n    data.amountRanges.push({\n      amount,\n      length\n    });\n  }\n\n  if (buffer[offset] == 0) {\n    offset += 1;\n    data.participationConfig = null;\n  } else {\n    const winnerConstraint = buffer[offset + 1];\n    const nonWinningConstraint = buffer[offset + 2];\n    let fixedPrice = null;\n    offset += 3;\n\n    if (buffer[offset] == 1) {\n      fixedPrice = new bn_js_1.default(buffer.slice(offset + 1, offset + 9), 'le');\n      offset += 9;\n    } else {\n      offset += 1;\n    }\n\n    data.participationConfig = {\n      winnerConstraint,\n      nonWinningConstraint,\n      fixedPrice\n    };\n  }\n\n  if (buffer[offset] == 0) {\n    offset += 1;\n    data.participationState = null;\n  } else {\n    const collectedToAcceptPayment = new bn_js_1.default(buffer.slice(offset + 1, offset + 9), 'le');\n    offset += 9;\n    data.participationState = {\n      collectedToAcceptPayment\n    };\n  }\n\n  return data;\n};","map":{"version":3,"mappings":"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","names":["WinningConfigType","exports","WinningConstraint","NonWinningConstraint","SafetyDepositConfig","mpl_core_1","constructor","pubkey","info","assertOwner","MetaplexProgram_1","PUBKEY","isCompatible","data","deserialize","SafetyDepositConfigV1","getPDA","auctionManager","safetyDeposit","findProgramAddress","buffer_1","from","PREFIX","toBuffer","web3_js_1","buffer","key","bs58_1","encode","slice","order","bn_js_1","winningConfigType","amountType","lengthType","amountRanges","participationConfig","participationState","lengthOfArray","offset","i","toNumber","amount","length","push","winnerConstraint","nonWinningConstraint","fixedPrice","collectedToAcceptPayment"],"sources":["../../../src/accounts/SafetyDepositConfig.ts"],"sourcesContent":[null]},"metadata":{},"sourceType":"script"}