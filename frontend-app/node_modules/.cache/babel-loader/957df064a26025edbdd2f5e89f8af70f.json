{"ast":null,"code":"\"use strict\";\n\nvar __awaiter = this && this.__awaiter || function (thisArg, _arguments, P, generator) {\n  function adopt(value) {\n    return value instanceof P ? value : new P(function (resolve) {\n      resolve(value);\n    });\n  }\n\n  return new (P || (P = Promise))(function (resolve, reject) {\n    function fulfilled(value) {\n      try {\n        step(generator.next(value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n\n    function rejected(value) {\n      try {\n        step(generator[\"throw\"](value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n\n    function step(result) {\n      result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected);\n    }\n\n    step((generator = generator.apply(thisArg, _arguments || [])).next());\n  });\n};\n\nvar __importDefault = this && this.__importDefault || function (mod) {\n  return mod && mod.__esModule ? mod : {\n    \"default\": mod\n  };\n};\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.AuctionWinnerTokenTypeTracker = void 0;\n\nconst mpl_core_1 = require(\"@metaplex-foundation/mpl-core\");\n\nconst web3_js_1 = require(\"@solana/web3.js\");\n\nconst bn_js_1 = __importDefault(require(\"bn.js\"));\n\nconst buffer_1 = require(\"buffer\");\n\nconst MetaplexProgram_1 = require(\"../MetaplexProgram\");\n\nclass AuctionWinnerTokenTypeTracker extends mpl_core_1.Account {\n  constructor(pubkey, info) {\n    super(pubkey, info);\n\n    if (!this.assertOwner(MetaplexProgram_1.MetaplexProgram.PUBKEY)) {\n      throw (0, mpl_core_1.ERROR_INVALID_OWNER)();\n    }\n\n    if (!AuctionWinnerTokenTypeTracker.isCompatible(this.info.data)) {\n      throw (0, mpl_core_1.ERROR_INVALID_ACCOUNT_DATA)();\n    }\n\n    this.data = deserialize(this.info.data);\n  }\n\n  static isCompatible(data) {\n    return data[0] === MetaplexProgram_1.MetaplexKey.AuctionWinnerTokenTypeTrackerV1;\n  }\n\n  static getPDA(auctionManager) {\n    return __awaiter(this, void 0, void 0, function* () {\n      return MetaplexProgram_1.MetaplexProgram.findProgramAddress([buffer_1.Buffer.from(MetaplexProgram_1.MetaplexProgram.PREFIX), MetaplexProgram_1.MetaplexProgram.PUBKEY.toBuffer(), new web3_js_1.PublicKey(auctionManager).toBuffer(), buffer_1.Buffer.from(MetaplexProgram_1.MetaplexProgram.TOTALS)]);\n    });\n  }\n\n}\n\nexports.AuctionWinnerTokenTypeTracker = AuctionWinnerTokenTypeTracker;\n\nconst deserialize = buffer => {\n  const data = {\n    key: MetaplexProgram_1.MetaplexKey.SafetyDepositConfigV1,\n    amountType: buffer[1],\n    lengthType: buffer[2],\n    amountRanges: []\n  };\n  const lengthOfArray = new bn_js_1.default(buffer.slice(3, 7), 'le');\n  let offset = 7;\n\n  for (let i = 0; i < lengthOfArray.toNumber(); i++) {\n    const amount = (0, mpl_core_1.getBNFromData)(buffer, offset, data.amountType);\n    offset += data.amountType;\n    const length = (0, mpl_core_1.getBNFromData)(buffer, offset, data.lengthType);\n    offset += data.lengthType;\n    data.amountRanges.push({\n      amount,\n      length\n    });\n  }\n\n  return data;\n};","map":{"version":3,"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;;AAQA;;AACA;;AACA;;AACA;;AAUA,MAAaA,6BAAb,SAAmDC,kBAAnD,CAA6F;AAC3FC,cAAYC,MAAZ,EAAkCC,IAAlC,EAA2D;AACzD,UAAMD,MAAN,EAAcC,IAAd;;AAEA,QAAI,CAAC,KAAKC,WAAL,CAAiBC,kCAAgBC,MAAjC,CAAL,EAA+C;AAC7C,YAAM,qCAAN;AACD;;AAED,QAAI,CAACP,6BAA6B,CAACQ,YAA9B,CAA2C,KAAKJ,IAAL,CAAUK,IAArD,CAAL,EAAiE;AAC/D,YAAM,4CAAN;AACD;;AAED,SAAKA,IAAL,GAAYC,WAAW,CAAC,KAAKN,IAAL,CAAUK,IAAX,CAAvB;AACD;;AAEkB,SAAZD,YAAY,CAACC,IAAD,EAAa;AAC9B,WAAOA,IAAI,CAAC,CAAD,CAAJ,KAAYH,8BAAYK,+BAA/B;AACD;;AAEkB,SAANC,MAAM,CAACC,cAAD,EAA6B;;AAC9C,aAAOP,kCAAgBQ,kBAAhB,CAAmC,CACxCC,gBAAOC,IAAP,CAAYV,kCAAgBW,MAA5B,CADwC,EAExCX,kCAAgBC,MAAhB,CAAuBW,QAAvB,EAFwC,EAGxC,IAAIC,mBAAJ,CAAcN,cAAd,EAA8BK,QAA9B,EAHwC,EAIxCH,gBAAOC,IAAP,CAAYV,kCAAgBc,MAA5B,CAJwC,CAAnC,CAAP;AAMD;AAAA;;AA1B0F;;AAA7FC;;AA6BA,MAAMX,WAAW,GAAIY,MAAD,IAAmB;AACrC,QAAMb,IAAI,GAAsC;AAC9Cc,OAAG,EAAEjB,8BAAYkB,qBAD6B;AAE9CC,cAAU,EAAEH,MAAM,CAAC,CAAD,CAF4B;AAG9CI,cAAU,EAAEJ,MAAM,CAAC,CAAD,CAH4B;AAI9CK,gBAAY,EAAE;AAJgC,GAAhD;AAOA,QAAMC,aAAa,GAAG,IAAIC,eAAJ,CAAOP,MAAM,CAACQ,KAAP,CAAa,CAAb,EAAgB,CAAhB,CAAP,EAA2B,IAA3B,CAAtB;AACA,MAAIC,MAAM,GAAG,CAAb;;AAEA,OAAK,IAAIC,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGJ,aAAa,CAACK,QAAd,EAApB,EAA8CD,CAAC,EAA/C,EAAmD;AACjD,UAAME,MAAM,GAAG,8BAAcZ,MAAd,EAAsBS,MAAtB,EAA8BtB,IAAI,CAACgB,UAAnC,CAAf;AACAM,UAAM,IAAItB,IAAI,CAACgB,UAAf;AACA,UAAMU,MAAM,GAAG,8BAAcb,MAAd,EAAsBS,MAAtB,EAA8BtB,IAAI,CAACiB,UAAnC,CAAf;AACAK,UAAM,IAAItB,IAAI,CAACiB,UAAf;AACAjB,QAAI,CAACkB,YAAL,CAAkBS,IAAlB,CAAuB;AAAEF,YAAF;AAAUC;AAAV,KAAvB;AACD;;AAED,SAAO1B,IAAP;AACD,CApBD","names":["AuctionWinnerTokenTypeTracker","mpl_core_1","constructor","pubkey","info","assertOwner","MetaplexProgram_1","PUBKEY","isCompatible","data","deserialize","AuctionWinnerTokenTypeTrackerV1","getPDA","auctionManager","findProgramAddress","buffer_1","from","PREFIX","toBuffer","web3_js_1","TOTALS","exports","buffer","key","SafetyDepositConfigV1","amountType","lengthType","amountRanges","lengthOfArray","bn_js_1","slice","offset","i","toNumber","amount","length","push"],"sources":["../../../src/accounts/AuctionWinnerTokenTypeTracker.ts"],"sourcesContent":[null]},"metadata":{},"sourceType":"script"}